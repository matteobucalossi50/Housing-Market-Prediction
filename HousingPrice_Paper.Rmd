---
title: "Housing Market - Seattle Area"
author: "Anti-Code Group"
date: "10/5/2019"
output:  
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(scipen = 999)
```

```{r basicfunct, include=FALSE}
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
```

```{r base_lib, include=FALSE}
loadPkg("dplyr")
loadPkg("tidyr")
loadPkg("tidyverse")
loadPkg("ggplot2")
loadPkg('ggmap')
loadPkg('rjson')
loadPkg('jsonlite')
loadPkg('leaflet')
loadPkg('grDevices')
loadPkg('scales')
loadPkg('RCurl')
loadPkg('sp')
loadPkg('geojsonio')
loadPkg('lmtest')
loadPkg("faraway")
loadPkg("corrplot")
loadPkg("modelr")
```

# Chapter 1: Introduction

*insert intro here: why this dataset, background research on topic and data, what this data and report about, table of contents description*

Seattle boasts among the "hottest" housing markets in the United States; as of July 2018, Seattle "led the nation in home price gains" for 21 straight months, topped only by Portland in the 1990s – a trend driven by the city's tech sector and a  lack of supply compared with demand (https://bit.ly/2v5UMcn). Given the Seattle housing market's notoriety for high prices, we were interested in exploring which variables affect housing price in this market. With this goal in mind, we found a public dataset on Kaggle ("House Sales in King County, USA") offering 21,613 observations across 21 variables. According to Kaggle, it "includes homes sold between May 2014 and May 2015." Although it doesn't explore macro-level variables affecting housing price (such as the local job market, Amazon presence, etc.), it does focus on micro-level variables, such as renovations, number of bedrooms, square feet of living space, etc. that are common to virtually all housing markets in the United States. As a result, our analysis could lay the groundwork for future comparative analysis with other housing markets across the country.

This report is organized as follows:

1. Description of the Data (explanation of the dataset and its variables, 
2. Geographic Coverage of Data
3. House Prices vs. Size
4. Factors Analysis
5. Multiple Linear Regression Model
6. Conclusion

# Chapter 2: Description Data
## Source Data

*can delete links and explain dataset and variables and all that, as well as what done with cleaning coding (including reasoning for log price, whici will later be more clear with graphs)* 

As mentioned previously, our dataset houses 21,613 observations across 21 variables. (See below for a readout of the dataset's structure and variable names.) Variable descriptions are as follows and come from the following link: https://bit.ly/2MsyRFl; astericks next to variable name indicates usage in our analysis:

```{r, echo=FALSE}
kc_house_data <- read.csv("kc_house_data.csv")
str(kc_house_data)
colnames(kc_house_data)
```

1. Id (unique ID for each home sold)
2. Date (date of the home sale)
3. Price (price of each home sold)***
4. Bedrooms (number of bedrooms)***
5. Bathrooms (number of bathrooms, where .5 accounts for a room with a toilet but no shower)
6. Sqft_living (square footage of the apartments' interior living space)***
7. Sqft_lot (square footage of the land space)***
8. Floors (number of floors)
9. Waterfront (a dummy variable for whether the apartment was overlooking the waterfront or not; 0 represents no waterfront)
10. View (an index from 0 to 4 of how the view of the property was)
11. Condition (an index from 1 to 5 on the condition of the apartment, with the lowest number representing poor condition)***
12. Grade (an index from 1 to 13, with the lowest number representation poor construction and design)***
13. Sqft_above (the the square footage of the interior housing space that is above ground level)
14. Sqft_basement (the square footage of the interior housing space that is below ground level)
15. yr_built (the year the house was initially built)***
16. yr_renovated (the year of the house's last renovation)***
17. zipcode (what zipcode area the house is in)***
18. Lat (latitude)***
19. Long (longitude)***
20. Sqft_living15 (the square footage of the interior housing living space for the nearest 15 neighbors)
21. Sqft_lot15 (the square footage of the land lots of the nearest 15 neighbors)

For our exploratory data analysis, we ignored "Id" and "Date" because these are independent variables with no relation to price. We also ignored "floors" because it can be considered a proxy for sqft_living. "Waterfront" and "View" were dropped because the vast majority of properties were coded as "0". We ignored sqft_basement and sqft_above because they were corollaries of "sqft_living" (we didn't want redundancy in our analysis). We also ignored "sqft_living 15" and "sqft_lot15" because we were interested only in the attributes of individual houses, not those of their surrounding neighborhoods (although that could make for an interesting follow-up study).

Following these decisions, we cleaned the data accordingly: we dropped "waterfront" and "view"; we subsetted the dataset to include only properties with more than 0 bedrooms and bathrooms (we considered these "outlier" properties); we subsetted the dataset to include only properties with less than 30 bedrooms (again, to exclude outlier properties); we dropped "NA" values from the dataset to simplify our analysis ("NA" values are hard to perform operations on); we converted "condition" and "grade" into factor variables because they are effectively intervals; and we ran "housing price" through a logarithmic function to make for better visualization.

```{r clean, include=FALSE}
kc_house_data <- subset(kc_house_data, select = -c(9, 10))

kc_house_data <- subset(kc_house_data, kc_house_data$bedrooms != 0)

kc_house_data <- subset(kc_house_data, kc_house_data$bathrooms != 0)

kc_house_data <- subset(kc_house_data, kc_house_data$bedrooms < 30)

kc_house_data <-  drop_na(kc_house_data)

kc_house_data$condition <- as.factor(kc_house_data$condition)

kc_house_data$grade <- as.factor(kc_house_data$grade)

price.ln = log(kc_house_data$price)

```

```{r, include=FALSE}
summary(kc_house_data$price)

print(mean(kc_house_data$price))

print(sd(kc_house_data$price))

print(var(kc_house_data$price))

```

*use inline code to describe dataset statistics and values*

## Geographic Coverage of Data
Below is a visualization of the points in the dataset by price, plotted with the leaflet library.
Note that the data have been divided by unequal bins to provide a better visualization of the distribution of housing price, so please read the legend carefully. More expensive houses tend to be concentrated near the water and center of the city.
 
```{r geo, echo=FALSE}
price.bins <- c(0, 250000, 500000, 750000, 1000000, 1250000, 1500000, 1750000, 2000000, 8000000)
qpal <-  colorBin(palette = 'GnBu', kc_house_data$price, bins= price.bins, n = 9)
house.map <- leaflet(kc_house_data) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addCircleMarkers(lng = ~long, lat = ~lat, 
                   stroke = FALSE, 
                   fillOpacity = 5, 
                   color = ~qpal(price), 
                   radius = 2,
                   label = ~as.character(paste0('Price: $', price, ", ", 'condition: ', condition, ", ", 'year built: ', yr_built))) %>%
  addLegend('bottomright', pal = qpal, values = ~price, opacity = 1, title = 'Price', labFormat = labelFormat(prefix = '$', between = ' - $'))

house.map

```

Here instead is a visualization of the observations by property lot sqft. Again, data have been divided by unequal bins to provide a better visualization of the distribution of housing price, so please read the legend carefully. Our observation follows common sense: the further one ventures outside the city center, the more land there is.

```{r geo2, echo=FALSE}

sqft.bins <- c(519,10000,200000,400000,660856, 1651359)

qpal <-  colorBin(palette = 'YlOrBr', kc_house_data$sqft_lot, bins= sqft.bins, n = 5)
house.map <- leaflet(kc_house_data) %>% 
  addProviderTiles("CartoDB.DarkMatter") %>% 
  addCircleMarkers(lng = ~long, lat = ~lat, 
                   stroke = FALSE, 
                   fillOpacity = 5, 
                   color = ~qpal(sqft_lot), 
                   radius = 2,
                   label = ~as.character(paste0('Sqft_lot: $', sqft_lot, ", ", 'condition: ', condition, ", ", 'year built: ', yr_built, 'price: ', price))) %>%
  addLegend('bottomright', pal = qpal, values = ~sqft_lot, opacity = 1, title = 'Sqft_lot', labFormat = labelFormat( between = ' - '))

house.map

```



# Chapter 3: House prices and sizes
## House Price

*descibe how price is min max etc, then inline code for price per sqft and how expensive seattle is etc*

A brief overview of the dataset yields the following observations for housing price: the minimum price is $78,000, while the maximum is $7,700,000 (quite a large range); the mean of the dataset is $540,198 (indicating that the dataset is right-skewed, as further indicated by the histogram below); the standard deviation of the dataset is $367,141.60; and the variance is 134,792,956,735 (quite large, indicating "that the data points are very spread out from the mean, and from one another" (https://bit.ly/2MZ1cCn).

```{r price hist, echo=FALSE}

hist(kc_house_data$price, xaxt="n", ylim = c(0,14000), col = "green", main = "Housing Price Histogram", xlab = "Housing Price ($)", cex.axis = .75)
axis(side=1, at=axTicks(1), 
     labels=formatC(axTicks(1), format="d", big.mark=','))


hist(kc_house_data$price[kc_house_data$price<=2000000], xaxt="n", ylim = c(0,5000), col = heat.colors(20), main = "Housing Price Histogram, $0-$2M Only", xlab = "Housing Price ($)", cex.axis = .75)
axis(side=1, at=axTicks(1), 
     labels=formatC(axTicks(1), format="d", big.mark=','))

qqnorm(kc_house_data$price, pch = 20, cex = .5, main = "Housing Prices: Normal Q-Q Plot", ylab = "Housing Price ($)", cex.axis = .75)

```
Just for context, the following readouts offer cross sections of Seattle's most expensive houses; average prices for each condition level; and average prices for each grade level.

### What do the most expensive houses look like?

From slicing the data, it looks like the most expensive houses are very well constructed, have tens of thousands of square feet of property, and have 5 or more bedrooms.

```{r top price, echo=FALSE}
print(top_n(kc_house_data, 5, price)) %>% arrange(desc(price))
```

### What is the average price for each condition level?

From the slice below, average prices seem to trend upward along with condition; average prices are in the hundreds of thousands.

```{r rop avg cond, echo=F}
print(aggregate(price~condition,data=kc_house_data,FUN=mean))

```

### What is the average price for each grade level?

From the slice below, we can see that price generally trends upward along with grade.

```{r rop avg grade, echo=F}
print(aggregate(price~grade,data=kc_house_data,FUN=mean))

```

## House Size

*add histograms for bedroom variable and sqft living variable - comment on them, why such house be that in real world etc etc..*

Below we have included histograms for "bedrooms", "sqft_living", and "sqft_lot". Upon inspecting the graphs, it becomes clear that most of the properties in this dataset have around 3 bedrooms, while the majority of properties are around 1000-2000 square feet (for reference, in 2015, the average US house size was around 2,600 square feet (https://bit.ly/32zY9Hi)); as for sqft_lot, most of the properties have between 5,000 and 10,000 square feet of land. As with the housing price histogram shown earlier, these histograms are right-skewed.

```{r bedroom hist, echo=FALSE}

hist(kc_house_data$bedrooms[kc_house_data$bedrooms<=6], col = "yellow", cex.axis = .75, xlab = "# Bedrooms", main = "# of Bedrooms Histogram")

```

```{r sqft_living hist, echo=FALSE}

hist(kc_house_data$sqft_living[kc_house_data$sqft_living<=6000], col = "yellow", cex.axis = .75, xlab = "Sqft Living", main = "Sqft Living Histogram")

```

```{r lot hist, echo=FALSE}

hist(kc_house_data$sqft_lot[kc_house_data$sqft_lot<=25000], xaxt="n", cex.axis = .75, xlab = "Land Area (sqft.)", main = "Histogram of Land Area, up to 25,000 sqft.", col = heat.colors(13))
axis(side=1, at=axTicks(1), 
     labels=formatC(axTicks(1), format="d", big.mark=','))
```

### What do the largest houses look like?
*introduce the reasoning of this passage and thendescribe each output with reason under each of them*

Going into this project, we hypothesized that larger houses would be priced higher than smaller houses. House size is determined in large part by "sqft_living", of which "bathrooms" and "bedrooms" are a part.

It is apparent here that the largest houses are also among the most expensive – they are all priced in the millions of dollars, which are outliers when compared to the dataset as a whole.

```{r top sqftliv, echo=FALSE}
print(top_n(kc_house_data, 5, sqft_living)) %>% arrange(desc(sqft_living))
```

The properties with the largest amount of land are also priced highly, but not as highly as those listed in the "sqft_living" readout. This could suggest a lower correlation between housing price and sqft_lot than that between housing price and sqft_living.

```{r top sqftlot, echo=FALSE}
print(top_n(kc_house_data, 5, sqft_lot))  %>% arrange(desc(sqft_lot))
```
The properties with the largest number of bedrooms are also priced highly (around or above the dataset mean of $540,000), but not quite as highly as those in the "sqft_living" readout. Since "bedrooms" contributes in part – but not in whole – to sqft_living, it makes sense that its correlation with housing price is lower than that of sqft_living.

```{r top bedrooms, echo=FALSE}
print(top_n(kc_house_data, 4, bedrooms))  %>% arrange(desc(bedrooms))
```


# Chapter 4: Factors Analysis
## SMART Question
Are houses of different sizes priced differently?

Now that we've taken a look at slices of the data, we can now delve deeper with some graphs. Below are scatterplots and boxplots of housing price vs. "sqft_living".

### Comparison of sqft living with price

From the scatterplot, it's apparent that there is a relatively strong, positive correlation between housing price and living space (.70192, to be exact). That is, as living space increases, so does housing price. Note that a majority of the data points lie below 6,000 sqft, and below $2 million.

```{r plot sqft living, echo=FALSE}

plot(kc_house_data$sqft_living, kc_house_data$price, xaxt="n", yaxt="n", pch = 20, cex = .1, xlab = "Square Feet of Living Space", ylab = "Housing Price ($)", cex.axis = .75, main = "Housing Price vs. Living Space")
abline(lm(kc_house_data$price ~ kc_house_data$sqft_living, data = kc_house_data), col = "orange")
legend(x='topright', legend=paste('Correlation =',round(cor(kc_house_data$sqft_living, kc_house_data$price),5)))
axis(side=1, at=axTicks(1), 
     labels=formatC(axTicks(1), format="d", big.mark=','))
axis(side=2, at=axTicks(2), 
     labels=formatC(axTicks(2), format="d", big.mark=','))
```

Now let's take a look at the same data with a boxplot; this time, we have "sqft_living" categorized by 5 intervals. From this visualization as well, it's apparent that "sqft_living" correlates positively with housing price. The last interval (10,891-13,540 sqft) seems to buck this trend, but it worth noting that only `r nrow(kc_house_data[kc_house_data$sqft_living >= 10891, ])` houses are part of this group – a small-n population, which could explain the discrepancy.


```{r boxplot sqft living, echo=FALSE}

sqft.living <- cut(kc_house_data$sqft_living, breaks = c(289,2940,5590,8240,10890,13540), labels = c("290-2,940", "2,941-5,590", "5,591-8,240", "8,241-10,890", "10,891-13,540"))


ggplot(kc_house_data, aes(x=sqft.living, y=price, fill=sqft.living)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Living Space") + ylab("Housing Price ($)") + xlab("Square Feet of Living Space") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

```

*explains bp test with inline code and not possible anova*
```{r anova living, include=FALSE}
bptest(kc_house_data$price~sqft.living)

```

### Comparison of sqft lot with price

Next up in our exploratory data analysis is housing price vs. "sqft_lot". How does land area correlate with housing price? According to our scatterplot, not very highly – there is a positive correlation of only .08988. This seems to suggest that sqft_lot is more weakly related to housing price than sqft_living. Indeed, the vast majority of data points in the scatterplot seem to trend upward in price with relatively small increases in land area.

```{r lot summary, include=FALSE}
summary(kc_house_data$sqft_lot)

```

```{r plot lot, echo=FALSE}

plot(kc_house_data$sqft_lot,kc_house_data$price, cex.axis = .75, pch = 20, cex = .1, xlab = "Land Area (sqft.)", ylab = "Housing Price ($)", xaxt="n", yaxt="n", main = "Housing Price vs. Land Area")
abline(lm(kc_house_data$price~kc_house_data$sqft_lot, data = kc_house_data), col = "orange")
legend(x='topright', legend=paste('Correlation =',round(cor(kc_house_data$sqft_lot, kc_house_data$price),5)))
axis(side=1, at=axTicks(1), 
     labels=formatC(axTicks(1), format="d", big.mark=','))
axis(side=2, at=axTicks(2), 
     labels=formatC(axTicks(2), format="d", big.mark=','))

```

Next, let's take a look at the same data in a boxplot. Unfortunately, the visualization isn't very readable; let's convert housing price through a logarithmic function to improve our y-axis scale.

```{r boxplot lot, echo=FALSE}

sqft.lot <- cut(kc_house_data$sqft_lot, breaks = c(519,330688,660856,991023,1321191, 1651359), labels = c("520-330K", "330K-660K", "660K-991K", "991K-1.3M", "1.3M-1.65M"))

ggplot(kc_house_data, aes(x=sqft.lot, y=price, fill=sqft.lot)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Land Area") + ylab("Housing Price ($)") + xlab("Land Area (sqft.)") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 


```

The modified boxplot below (with the logarithmic scale) is much easier to interpret. We can see that housing price increases as land area increases, but only to an extent. Note that houses in the 991,000-1.3M sqft and 1.3M-1.65M sqft ranges appear to buck the trend. Once again, this can be explained by the fact that only a few houses are part of these two intervals – only `r nrow(kc_house_data[kc_house_data$sqft_lot >= 991000, ])` to be exact.

```{r boxplot lot log, echo=FALSE}

ggplot(kc_house_data, aes(x=sqft.lot, y=price.ln, fill=sqft.lot)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Land Area (log)") + ylab("Housing Price ($)") + xlab("Land Area (sqft.)") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

```

*explain results of anova inline code etc*

```{r anova land}

bptest(kc_house_data$price~sqft.lot)

land.anova <- aov(kc_house_data$price~sqft.lot)
summary(land.anova)

TKcond <- TukeyHSD(land.anova)
TKcond
```


### Comparison of number of bedrooms with price

Here, we have a logarithmic box plot of housing price vs. "bedrooms". There appears to be a clear trend: as the number of bedrooms increases, housing price increases as well. The 9-11 interval bucks the trend slightly, but again, this can be explained by the fact that only `r nrow(kc_house_data[kc_house_data$bedrooms >= 9, ])` houses are part of this interval, compared with `r nrow(kc_house_data[kc_house_data$bedrooms <= 8, ])` total for the others.

```{r, echo=FALSE}

number.bedrooms <- cut(kc_house_data$bedrooms, breaks = c(0,3,6,9,11), labels = c("1-2", "3-5", "6-8", "9-11"))

ggplot(kc_house_data, aes(x=number.bedrooms, y=price.ln, fill=number.bedrooms)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. # Bedrooms (log)") + ylab("Housing Price ($)") + xlab("# Bedrooms") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

```

*same for anova bedrooms*

```{r anova bedrooms}
bptest(kc_house_data$price~number.bedrooms)

```

*can use chisq to see if more rooms more cost - smart question to intro, explain chisq (hypothesis, categ tranformation, results etc*
```{r chisq rooms}

price.intrv = cut(kc_house_data$price, c(0, 250000, 500000, 750000, 1000000, 1250000, 1500000, 1750000, 2000000))

number.bathrooms <- cut(kc_house_data$bathrooms, breaks = c(0,2,4,6,8), labels = c("0.5-1.5", "2-3.5", "4-5.5", "6-8"))

bed_p <- table(number.bedrooms, price.intrv)
x2test1 = chisq.test(bed_p)
x2test1

bath_p <- table(number.bathrooms, price.intrv)
x2test2 = chisq.test(bath_p)
x2test2

```



## SMART Question
Are houses of different quality priced differently? *check all these questions make sense given what nick said*

### Comparison of condition with price
**explain well this variable, what represents etc as they asked*

Here, we compare "condition" with housing price. Once again, "condition" represents an index from 1 to 5, with the lowest number representing poor condition. Once we take a look at the boxplot below (the second one is logarithmized for clearer visualization), it becomes clear that apartment condition correlates positively with housing price. 

```{r, echo=FALSE}

ggplot(kc_house_data, aes(x=condition, y=price, fill=condition)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Apartment Condition") + ylab("Housing Price ($)") + xlab("Apartment Condition") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 


ggplot(kc_house_data, aes(x=condition, y=price.ln, fill=condition)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Apartment Condition (log)") + ylab("Housing Price ($)") + xlab("Apartment Condition") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

```

*explains anova test tukey and all*
```{r anova condition}
bptest(price~condition, data = kc_house_data)

cond.anova <- aov(kc_house_data$price~kc_house_data$condition)
summary(cond.anova)

TKcond <- TukeyHSD(cond.anova)
TKcond
```

### Comparison of grade with price 
*explain well this variable, what represents etc as they asked, design/construction*

Here we have a boxplot comparing "grade" with housing price. Once again, "grade" represents an index from 1 to 13, with the lowest number representing poor construction and design. The trend is clear: construction and design grade correlate positively with housing price.

```{r, echo=FALSE}

ggplot(kc_house_data, aes(x=grade, y=price.ln, fill=grade)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Apartment Grade (log)") + ylab("Housing Price ($)") + xlab("Apartment Grade") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

```

*no anova..*
```{r anova grade, include=FALSE}
bptest(price~grade, data = kc_house_data)

```


*explains chi-sq results and how they related*
```{r chisq grade}

cond.tbl <- table(kc_house_data$condition, kc_house_data$grade)
chisq.cond <- chisq.test(cond.tbl)
chisq.cond
```


## SMART Question
Are older houses priced differently?

### Comparison of year they were built with price

Here, we have a comparison of "yr_built" with housing price. Once we take a look at the logarithmic boxplot, we see no obvious trends. Housing price trends downward from 1900-1969, and then picks back up from 1970-2015. What might explain this? Well, "yr_built" does not take "yr_renovated" into account. For instance, two equivalent houses built in the same year could have different house prices, depending on if one has been renovated while the other hasn't.

```{r, echo=FALSE}

year.built <- cut(kc_house_data$yr_built, breaks = c(1899,1923,1946,1969,1992,2015), labels = c("1900-1923", "1924-1946", "1947-1969", "1970-1992", "1993-2015"))

ggplot(kc_house_data, aes(x=year.built, y=price.ln, fill=year.built)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Year Built (log)") + ylab("Housing Price ($)") + xlab("Year Built") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

```

```{r yr_built_by_renovation_status, echo=FALSE}

norenov <- subset(kc_house_data, kc_house_data$yr_renovated == 0)
price.ln.noren = log(norenov$price)
year.built.noren <- cut(norenov$yr_built, breaks = c(1899,1923,1946,1969,1992,2015), labels = c("1900-1923", "1924-1946", "1947-1969", "1970-1992", "1993-2015"))

```

Let's construct the same boxplots, but this time indexed by "yr_renovated".

Unfortunately, the vast majority of properties in this dataset have never been renovated (`r nrow(norenov)` to be exact). This means that only 914 properties have been renovated. This makes the resulting boxplots somewhat uninformative – the larger population boxplot (not renovated) largely mirrors the patterns of the previous graph, and the smaller population graph (renovated) is based on a population too small to run meaningful analysis on. We have included the graphs here to showcase our thought process, but we are well aware of their limitations.

```{r yr_built_by_renovation_status2, echo=FALSE}

norenov <- subset(kc_house_data, kc_house_data$yr_renovated == 0)
price.ln.noren = log(norenov$price)
year.built.noren <- cut(norenov$yr_built, breaks = c(1899,1923,1946,1969,1992,2015), labels = c("1900-1923", "1924-1946", "1947-1969", "1970-1992", "1993-2015"))

ggplot(norenov, aes(x=year.built.noren, y=price.ln.noren, fill=year.built.noren)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Not Renovated Housing Price vs. Years Built(log)") + ylab("Housing Price ($)") + xlab("Year Built") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 

renov <- subset(kc_house_data, kc_house_data$yr_renovated != 0)
price.ln.ren = log(renov$price)
year.built.ren <- cut(renov$yr_built, breaks = c(1899,1923,1946,1969,1992,2015), labels = c("1900-1923", "1924-1946", "1947-1969", "1970-1992", "1993-2015"))

ggplot(renov, aes(x=year.built.ren, y=price.ln.ren, fill=year.built.ren)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Renovated Housing Price vs. Years Built(log)") + ylab("Housing Price ($)") + xlab("Year Built") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma) 
  
```

Here, we've graphed housing price by yr_renovated itself. This graph also showcases only 914 properties – the ones that were renovated. Generally speaking, as "yr_renovated" approaches the present day, price increases. The exception is between the 1924-1946 and 1947-1969 intervals; note however, that only `r nrow(kc_house_data[kc_house_data$yr_renovated >0 & kc_house_data$yr_renovated <= "1946", ])` properties occupy the first interval.

```{r price_by_year_renovated, echo=FALSE}

year.renov.noren <- cut(renov$yr_renovated, breaks = c(1899,1923,1946,1969,1992,2015), labels = c("1900-1923", "1924-1946", "1947-1969", "1970-1992", "1993-2015"))

ggplot(renov, aes(x=year.renov.noren, y=price.ln.ren, fill=year.renov.noren)) + geom_boxplot() + scale_fill_brewer(palette="Spectral") + ggtitle("Housing Price vs. Years Renovated(log)") + ylab("Housing Price ($)") + xlab("Year Renovated") +  theme(plot.title= element_text(hjust=0.5, size = 14)) + scale_y_continuous(labels = comma)

```


*no anova..*
```{r anova year}
bptest(kc_house_data$price~year.built)

```

*explain results and problems with it, introduce for next analysis below*

### Comparison of year renovated with price

*charts and all*

*do anova for this one too*


**compared renovated with built and see price changes too..**


### Are older houses worst in terms of quality?
*use chisq to assess old and quality independence*

```{r chisq year}

gradey.tbl <- table(kc_house_data$grade, year.built)
chisq.gradey <- chisq.test(gradey.tbl)
chisq.gradey

```

```{r chisq year 2}

condy.tbl <- table(kc_house_data$condition, year.built)
chisq.condy <- chisq.test(condy.tbl)
chisq.condy

```

### Does quality get better when renovated?
*use chisq to assess renovated and quality indep - replicate above chisq tests for year.renov*
 


**subset for older houses with renovation and rerun both tests and see difference in time**

like older house renovated cost normal? median house are still not renovated? how is the condition grade for older one? how is it for older renovated how is it for newer? how price changes in all these dynamics etc
like they wanted us to go in depth of that cause it actually makes sense


# Chapter 5: Multiple Linear Regression Model

## SMART Question:
What factors influence the house price the most?

### LSRL Model building

Below is our regression model, along with a comprehensive correlation plot.

#### First, take a look at all numeric variables and their correlation.

```{r}
h2 <- subset(kc_house_data,select = c(price,bedrooms,bathrooms,sqft_living,sqft_lot,floors,sqft_above,sqft_basement,yr_built ))
hcor = cor(h2)
corrplot(hcor, method = "number", type="upper")
```
yr_built and sqft_lot seem unrelated to price as their correlation coefficient is almost 0; accordingly, we do not choose them as independent variables to predict house price.


```{r}
model1 <- lm(price~.-sqft_lot-yr_built,data=h2)
summary(model1)
```
The coefficient of "sqft_basement" is NA, which indicates it has a problem with the other variables, so we dropped this one. And the p-value of "bathroom" is too large (meaning it's insignificant), so we dropped this one as well.


```{r}
model2 <- lm(price~.-sqft_lot-yr_built-sqft_basement-bathrooms,data=h2)
summary(model2)
vif(model2)
```

Everything looks better now; we also checked the VIF value of each variable and none of them is too large, indicating no  multicollineraty. We then added the two factor variables ("grade" and "condition") into the dataset to see their effects.

```{r}
h3 <- subset(kc_house_data,select = c(price,bedrooms,sqft_living,sqft_above,floors,grade,condition) )
summary(h3)
```

```{r}
model3 <- lm(price~.,data=h3)
summary(model3)
vif(model3)
```

The 5 levels of the "condition" variable are all insignificant, so we can  drop the "condition" variable. For the "grade" variable, higher grade levels have significant effects on price. By contrast, low grade does not affect price significantly. 

```{r}
model11 <- lm(price~.-condition,data=h3)
summary(model11)
vif(model11)
```
Now, we've added the interaction term into the model, since we want to see if the correlation of variables would affect the price prediction. We first put all interactions into the model to see what would happen.

```{r}
h4<-subset(kc_house_data,select=c(price,bedrooms,sqft_living,sqft_above,floors,grade))
model4<-lm(price~.+bedrooms:sqft_living+bedrooms:floors+bedrooms:sqft_above+sqft_living:floors+sqft_living:sqft_above+floors:sqft_above,data = h4)
summary(model4)
vif(model4)
```

We dropped the insignificant interactions and some interactions would cause certain variables to be insignificant as well, so we also drop these variables. Here is what's left; this model seems nice. 

```{r digit=9}
model5<-lm(price~.+bedrooms:sqft_above+sqft_living:sqft_above,data = h4)
summary(model5)
vif(model5)
```

### Final results and approved model for prediction of price
*explain coefficients and all that - use inline coding etc..*
### Price = 142000 +bedrooms*(-31710+10.72*sqft_above)+sqft_living*(170+2.943*sqft_above)+sqft_above*(-228.6)+floors*14570+grade()*

Problem: As the price histogram above is quite left-skewed, it means there are many outliers whose price is very high in the dataset. While we built the model, we did not exclude the outliers as we considered these values important. As a result, our final model is also skewed a bit. It means that for low price houses, our model may predict higher-than-normal prices, and for high price houses, our model will predict lower-than-normal prices. 


# Chapter 6: Conclusion
*final insights, main relationships, predictors, what to look in a real estate dataset etc..*
*future openings for further studies, analysis, tests etc on this..*


# Bibliography

